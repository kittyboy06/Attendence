import{u as Ue,r as l,s as a,j as e,L as Re,S as ze,P as G,B as Ve,R as Fe,b as oe,A as Xe,d as Ge}from"./AttendanceView-Dzhb8Iah.js";const Je=()=>{const S=Ue(),[q,ie]=l.useState(!1),[J,ce]=l.useState(""),[o,xe]=l.useState("teachers"),[ue,T]=l.useState(!1),[w,K]=l.useState([]),[N,Q]=l.useState([]),[me,he]=l.useState([]),[M,Y]=l.useState([]),[Z,ge]=l.useState([]),[k,pe]=l.useState(new Date().toISOString().split("T")[0]),[be,fe]=l.useState(null),[I,ee]=l.useState(""),[n,C]=l.useState(null),[W,$]=l.useState(""),[se,U]=l.useState("Dr."),[R,z]=l.useState("0000"),x=l.useRef({}),[je,V]=l.useState(!1),[E,te]=l.useState(null),[p,P]=l.useState({name:"",code:""}),[b,_]=l.useState({day:"Monday",period:1,subject:"",teacher:""}),[u,L]=l.useState({name:"",register_no:"",status:"Active"}),[ae,ye]=l.useState([]),[f,F]=l.useState({date:"",description:""}),[re,ve]=l.useState([]),[m,H]=l.useState({date:"",day_order:"Monday",description:""}),[X,we]=l.useState(!1),[h,O]=l.useState({start:"",end:""}),[j,le]=l.useState(new Set([1]));l.useEffect(()=>{q&&i()},[q,o,k]);const Ne=()=>{J==="admin123"?ie(!0):alert("Invalid Password")},i=async()=>{if(T(!0),o==="teachers"){const{data:s}=await a.from("teachers").select("*").order("created_at");K(s||[])}else if(o==="subjects"){const{data:s}=await a.from("subjects").select("*").order("created_at");Q(s||[])}else if(o==="students"){const{data:s}=await a.from("students").select("*").order("register_no");Y(s||[])}else if(o==="schedule"){const{data:s}=await a.from("time_table").select("*, subjects(name, code), teachers(name)").order("day_of_week");he(s||[]);const{data:t}=await a.from("teachers").select("*"),{data:r}=await a.from("subjects").select("*");K(t||[]),Q(r||[])}else if(o==="history"){const{data:s}=await a.from("attendance_logs").select("*, subjects(name, code), teachers(name)").eq("date",k);if(ge(s||[]),M.length===0){const{data:t}=await a.from("students").select("*");Y(t||[])}}else if(o==="settings"){const{data:s}=await a.from("settings").select("value").eq("key","academic_start_date").maybeSingle();s&&ee(s.value);const{data:t}=await a.from("holidays").select("*").order("date");ye(t||[]);const{data:r}=await a.from("special_schedules").select("*").order("date");ve(r||[])}T(!1)},g=()=>{C(null),$(""),U("Dr."),z("0000"),te(null),x.current&&x.current.clear&&x.current.clear(),P({name:"",code:""}),_({day:"Monday",period:1,subject:"",teacher:""}),L({name:"",register_no:"",status:"Active"})},Se=async()=>{if(!I)return;const{error:s}=await a.from("settings").upsert({key:"academic_start_date",value:I});alert(s?"Error saving settings":"Settings saved!")},ke=async()=>{if(!f.date||!f.description){alert("Please enter Date and Description");return}const{error:s}=await a.from("holidays").insert(f);s?alert(s.message):(F({date:"",description:""}),i())},Ce=async s=>{if(!confirm("Delete this holiday?"))return;const{error:t}=await a.from("holidays").delete().eq("id",s);t?alert(t.message):i()},_e=async()=>{if(!m.date)return alert("Select a date");const{error:s}=await a.from("special_schedules").upsert({date:m.date,day_order:m.day_order,description:m.description},{onConflict:"date"});s?alert(s.message):(H({date:"",day_order:"Monday",description:""}),i())},Le=async s=>{if(!confirm("Remove this override?"))return;const{error:t}=await a.from("special_schedules").delete().eq("id",s);t?alert(t.message):i()},Ae=async s=>{if(!confirm("Delete this attendance record? This cannot be undone."))return;const{error:t}=await a.from("attendance_logs").delete().eq("id",s);t?alert(t.message):i()},De=async()=>{if(!W.trim())return;const s=se+" "+W;let t=null;if(E){const r=await(await fetch(E)).blob(),c="ref_sig_"+Date.now()+".png",{error:d}=await a.storage.from("signatures").upload(c,r);d||(t=a.storage.from("signatures").getPublicUrl(c).data.publicUrl)}if(n){const r={name:s,pin:R};t&&(r.signature_url=t);const{error:c}=await a.from("teachers").update(r).eq("id",n);c&&alert(c.message)}else{const{error:r}=await a.from("teachers").insert({name:s,pin:R,signature_url:t});r&&alert(r.message)}g(),i()},Te=s=>{C(s.id);const t=s.name.split(" ");U(t[0]),$(t.slice(1).join(" ")),z(s.pin||"0000"),x.current&&x.current.clear&&x.current.clear()},Me=async s=>{if(!confirm("Delete this teacher?"))return;const{error:t}=await a.from("teachers").delete().eq("id",s);t?alert(t.message):i()},Ee=async()=>{if(!p.name)return;const s={name:p.name,code:p.code.trim()||null};if(n){const{error:t}=await a.from("subjects").update(s).eq("id",n);t&&alert(t.message)}else{const{error:t}=await a.from("subjects").insert(s);t&&alert(t.message)}g(),i()},Pe=s=>{C(s.id),P({name:s.name,code:s.code||""})},He=async s=>{if(!confirm("Delete this subject?"))return;const{error:t}=await a.from("subjects").delete().eq("id",s);t?alert(t.message):i()},Oe=async()=>{const{day:s,subject:t,teacher:r}=b;if(!s||!t||!r){alert("Please select Day, Subject, and Teacher");return}if(j.size===0){alert("Please select at least one period");return}const c=Array.from(j);let d=!1;for(const A of c){const B=G.find(v=>v.id===A);let y=B?.start,D=B?.end;if(A===0){if(!h.start||!h.end){alert("Please set Start and End time for Extra Class.");return}y=h.start,D=h.end}y&&y.length===5&&(y+=":00"),D&&D.length===5&&(D+=":00");const ne={day_of_week:s,period_number:A,start_time:y,end_time:D,subject_id:t,teacher_id:r};if(n){const{error:v}=await a.from("time_table").update(ne).eq("id",n);v&&(console.error(v),d=!0);break}else{const{error:v}=await a.from("time_table").insert(ne);v&&(console.error(v),d=!0)}}d?alert("Some operations failed. See console."):g(),O({start:"",end:""}),i()},Be=s=>{C(s.id),_({day:s.day_of_week,period:s.period_number,subject:s.subject_id,teacher:s.teacher_id}),le(new Set([s.period_number])),s.period_number===0&&O({start:s.start_time?s.start_time.slice(0,5):"",end:s.end_time?s.end_time.slice(0,5):""})},qe=async s=>{if(!confirm("Delete this class?"))return;const{error:t}=await a.from("time_table").delete().eq("id",s);t?alert(t.message):i()},Ie=async()=>{if(!(!u.name||!u.register_no)){if(n){const{error:s}=await a.from("students").update(u).eq("id",n);s&&alert(s.message)}else{const{error:s}=await a.from("students").insert(u);s&&alert(s.message)}g(),i()}},We=s=>{C(s.id),L({name:s.name,register_no:s.register_no,status:s.status||"Active"})},$e=async s=>{if(!confirm("Delete this student?"))return;const{error:t}=await a.from("students").delete().eq("id",s);t?alert(t.message):i()},de=async s=>{if(s===0){const y={period_number:0,subject_id:N.length>0?N[0].id:null,teacher_id:w.length>0?w[0].id:null,subjects:N.length>0?N[0]:{name:"Select Subject",code:"EXT"},teachers:w.length>0?w[0]:{name:"Select Teacher"}};S("/",{state:{manualMode:!0,manualClassData:y,from:"/admin"}});return}const t=new Date(k),c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][t.getDay()];T(!0);const{data:d,error:A}=await a.from("time_table").select("*, subjects(name, code), teachers(name)").eq("day_of_week",c).eq("period_number",s).maybeSingle();if(T(!1),A){alert("Error fetching schedule");return}if(!d){alert(`No class scheduled for ${c} Period ${s}.`);return}const B={...d,date:k};S("/",{state:{manualMode:!0,manualClassData:B,from:"/admin"}})};return q?e.jsxs("div",{className:"h-full bg-gray-50 flex flex-col sm:max-w-md sm:mx-auto",children:[e.jsx("div",{className:"bg-white p-4 shadow-sm flex-none z-10 sticky top-0",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Admin Dashboard"})}),ue&&e.jsx(Re,{}),e.jsx("div",{className:"bg-white border-b overflow-x-auto flex-none",children:e.jsx("div",{className:"flex px-4 py-2 gap-2 min-w-max",children:["teachers","subjects","students","schedule","history","settings"].map(s=>e.jsx("button",{onClick:()=>xe(s),className:`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all ${o===s?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-600"}`,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pb-20",children:[o==="teachers"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-gray-100 space-y-3",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800",children:n?"Edit Teacher":"Add Teacher"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:"border p-3 rounded-xl bg-gray-50 w-20 flex-shrink-0",value:se,onChange:s=>U(s.target.value),children:[e.jsx("option",{children:"Dr."}),e.jsx("option",{children:"Prof."}),e.jsx("option",{children:"Mr."}),e.jsx("option",{children:"Ms."}),e.jsx("option",{children:"Mrs."})]}),e.jsx("input",{className:"border p-3 rounded-xl bg-gray-50 flex-1 w-full",placeholder:"Name",value:W,onChange:s=>$(s.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"border p-3 rounded-xl bg-gray-50 w-24 text-center font-mono",placeholder:"PIN",type:"tel",maxLength:4,value:R,onChange:s=>z(s.target.value)}),e.jsx("button",{onClick:()=>{V(!0),setTimeout(()=>x.current?.clear(),100)},className:`flex-1 py-3 rounded-xl text-white font-medium shadow-sm active:scale-95 transition-all text-sm ${E?"bg-green-500":"bg-gray-400"}`,children:E?"Sig Captured":"Capture Sig"})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:De,className:`flex-1 ${n?"bg-orange-500":"bg-blue-600"} text-white py-3 rounded-xl font-bold shadow-md`,children:n?"Update":"Add"}),n&&e.jsx("button",{onClick:g,className:"text-gray-400 py-3 px-4 font-medium",children:"Cancel"})]})]})]}),je&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Draw Signature"}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-xl overflow-hidden bg-white relative h-64 mb-4",children:e.jsx(ze,{ref:x,canvasProps:{className:"sigCanvas w-full h-full"}})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>V(!1),className:"flex-1 py-3 rounded-xl bg-gray-100 text-gray-600 font-medium",children:"Cancel"}),e.jsx("button",{onClick:()=>x.current.clear(),className:"flex-1 py-3 rounded-xl bg-red-50 text-red-500 font-medium",children:"Clear"}),e.jsx("button",{onClick:()=>{x.current.isEmpty()?alert("Please sign first"):(te(x.current.toDataURL("image/png")),V(!1))},className:"flex-1 py-3 rounded-xl bg-blue-600 text-white font-bold",children:"Save"})]})]})}),e.jsx("div",{className:"space-y-3",children:w.map(s=>e.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm flex justify-between items-center border border-gray-100",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-gray-800",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-xs bg-gray-100 text-gray-500 px-2 py-0.5 rounded",children:["PIN: ",s.pin]}),s.signature_url&&e.jsx("span",{className:"text-xs bg-green-100 text-green-600 px-2 py-0.5 rounded",children:"Sig Added"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Te(s),className:"bg-blue-50 text-blue-600 p-2 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),e.jsx("button",{onClick:()=>Me(s.id),className:"bg-red-50 text-red-600 p-2 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},s.id))})]}),o==="subjects"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-gray-100 space-y-3",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800",children:n?"Edit Subject":"Add Subject"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("input",{className:"border p-3 rounded-xl bg-gray-50",placeholder:"Subject Name",value:p.name,onChange:s=>P({...p,name:s.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"border p-3 rounded-xl bg-gray-50 flex-1",placeholder:"Code (e.g., CS101)",value:p.code,onChange:s=>P({...p,code:s.target.value})}),e.jsx("button",{onClick:Ee,className:`${n?"bg-orange-500":"bg-blue-600"} text-white px-6 rounded-xl font-bold shadow-md`,children:n?"Update":"Add"})]}),n&&e.jsx("button",{onClick:g,className:"text-gray-400 text-sm text-center",children:"Cancel"})]})]}),e.jsx("div",{className:"space-y-3",children:N.map(s=>e.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm flex justify-between items-center border border-gray-100",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-gray-800 leading-tight",children:s.name}),e.jsx("span",{className:"text-xs bg-blue-50 text-blue-600 px-2 py-0.5 rounded mt-1 inline-block",children:s.code})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Pe(s),className:"bg-blue-50 text-blue-600 p-2 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),e.jsx("button",{onClick:()=>He(s.id),className:"bg-red-50 text-red-600 p-2 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},s.id))})]}),o==="students"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-gray-100 space-y-3",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800",children:n?"Edit Student":"Add Student"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("input",{className:"border p-3 rounded-xl bg-gray-50",placeholder:"Student Name",value:u.name,onChange:s=>L({...u,name:s.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"border p-3 rounded-xl bg-gray-50 w-full",placeholder:"Reg No.",value:u.register_no,onChange:s=>L({...u,register_no:s.target.value})}),e.jsxs("select",{className:"border p-3 rounded-xl bg-white flex-1 min-w-[100px]",value:u.status||"Active",onChange:s=>L({...u,status:s.target.value}),children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Long Absent",children:"Absent"}),e.jsx("option",{value:"Drop Out",children:"Dropped"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:Ie,className:`w-full ${n?"bg-orange-500":"bg-blue-600"} text-white py-3 rounded-xl font-bold shadow-md`,children:n?"Update Student":"Add Student"}),n&&e.jsx("button",{onClick:g,className:"text-gray-400 px-2",children:"Cancel"})]})]})]}),e.jsx("div",{className:"space-y-3",children:M.map(s=>e.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm flex justify-between items-center border border-gray-100",children:[e.jsxs("div",{className:"min-w-0 pr-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-bold text-gray-900 block truncate",children:s.name}),s.status==="Long Absent"&&e.jsx("span",{className:"text-[10px] bg-red-100 text-red-800 px-2 py-0.5 rounded-full border border-red-200 whitespace-nowrap",children:"Long Absent"}),s.status==="Drop Out"&&e.jsx("span",{className:"text-[10px] bg-gray-200 text-gray-800 px-2 py-0.5 rounded-full border border-gray-300 whitespace-nowrap",children:"Dropout"})]}),e.jsx("span",{className:"text-xs text-gray-400",children:s.register_no})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>We(s),className:"bg-blue-50 text-blue-600 p-2 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),e.jsx("button",{onClick:()=>$e(s.id),className:"bg-red-50 text-red-600 p-2 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},s.id))})]}),o==="schedule"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-gray-100 space-y-3",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800",children:n?"Edit Class":"Add Class"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("select",{className:"border p-3 rounded-xl bg-gray-50 w-full",value:b.day,onChange:s=>_({...b,day:s.target.value}),children:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:G.filter(s=>!s.type||s.type==="extra").map(s=>{const t=j&&j.has(s.id);return e.jsx("button",{onClick:()=>{const r=new Set(j);s.id===0?r.has(0)?r.delete(0):(r.clear(),r.add(0)):(r.has(0)&&r.delete(0),r.has(s.id)?r.delete(s.id):r.add(s.id)),le(r)},className:`py-2 rounded-lg text-sm font-bold border-2 transition-all ${t?"bg-blue-600 border-blue-600 text-white shadow-md":"bg-white border-gray-200 text-gray-400 hover:border-gray-300"}`,children:s.id===0?"Extra":s.id},s.id)})}),j&&j.has(0)&&e.jsxs("div",{className:"flex gap-2 animate-fade-in",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 ml-1",children:"Start Time"}),e.jsx("input",{type:"time",className:"w-full border p-3 rounded-xl bg-purple-50 border-purple-200",value:h.start,onChange:s=>O({...h,start:s.target.value})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 ml-1",children:"End Time"}),e.jsx("input",{type:"time",className:"w-full border p-3 rounded-xl bg-purple-50 border-purple-200",value:h.end,onChange:s=>O({...h,end:s.target.value})})]})]}),e.jsxs("select",{className:"border p-3 rounded-xl bg-gray-50 w-full",value:b.subject,onChange:s=>_({...b,subject:s.target.value}),children:[e.jsx("option",{value:"",children:"Select Subject"}),N.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("select",{className:"border p-3 rounded-xl bg-gray-50 w-full",value:b.teacher,onChange:s=>_({...b,teacher:s.target.value}),children:[e.jsx("option",{value:"",children:"Select Teacher"}),w.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:Oe,className:`flex-1 ${n?"bg-orange-500":"bg-blue-600"} text-white py-3 rounded-xl font-bold shadow-md`,children:n?"Update Class":"Add Class"}),n&&e.jsx("button",{onClick:g,className:"text-gray-400 px-4 font-medium",children:"Cancel"})]})]}),e.jsx("div",{className:"space-y-3",children:me.map(s=>{const t=G.find(r=>r.id===s.period_number);return e.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm flex justify-between items-center border border-gray-100",children:[e.jsxs("div",{children:[e.jsx("span",{className:`text-xs font-bold px-2 py-0.5 rounded ${s.period_number===0?"bg-purple-50 text-purple-600":"bg-blue-50 text-blue-600"}`,children:s.day_of_week}),e.jsx("div",{className:"font-bold text-gray-800 mt-1",children:s.subjects?.name}),e.jsxs("div",{className:"text-sm text-gray-500 mt-0.5",children:[s.period_number===0?`Extra Class (${s.start_time?.slice(0,5)} - ${s.end_time?.slice(0,5)})`:`${t?.label||"Period "+s.period_number} (${t?.start||""})`," • ",s.teachers?.name]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Be(s),className:"bg-blue-50 text-blue-600 p-2 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),e.jsx("button",{onClick:()=>qe(s.id),className:"bg-red-50 text-red-600 p-2 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},s.id)})})]}),o==="history"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-gray-100 space-y-3",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800",children:"Select Date"}),e.jsx("input",{type:"date",className:"border p-3 rounded-xl bg-gray-50 w-full",value:k,onChange:s=>pe(s.target.value)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-gray-100",children:[e.jsxs("button",{onClick:()=>we(!X),className:"w-full bg-indigo-600 text-white py-3 rounded-xl font-bold shadow-md active:scale-95 transition-all flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),X?"Cancel":"Add Past Attendance"]}),X&&e.jsxs("div",{className:"mt-4 animate-fade-in",children:[e.jsx("div",{className:"grid grid-cols-4 gap-2 mb-2",children:[1,2,3,4,5,6,7,8].map(s=>e.jsxs("button",{onClick:()=>de(s),className:"bg-indigo-50 hover:bg-indigo-100 text-indigo-700 font-bold py-3 rounded-xl border border-indigo-200 transition-colors",children:["Period ",s]},s))}),e.jsx("button",{onClick:()=>de(0),className:"w-full bg-purple-50 hover:bg-purple-100 text-purple-700 font-bold py-3 rounded-xl border border-purple-200 transition-colors",children:"Extra Class (Custom)"})]})]}),e.jsxs("div",{className:"space-y-3",children:[Z.length===0?e.jsx("p",{className:"text-center text-gray-400 py-10",children:"No records found for this date."}):null,Z.map(s=>{const t=be===s.id,r=M.filter(d=>s.absentees_json?.includes(d.id)).map(d=>d.name),c=M.filter(d=>s.od_students_json?.includes(d.id)).map(d=>d.name);return e.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-gray-100 cursor-pointer active:scale-[0.99] transition-transform",onClick:()=>fe(t?null:s.id),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-800",children:s.subjects?.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.teachers?.name}),e.jsxs("div",{className:"text-xs mt-1",children:[e.jsxs("span",{className:"bg-red-50 text-red-600 px-2 py-0.5 rounded border border-red-100 mr-2",children:["Absent: ",s.absentees_json?.length]}),e.jsxs("span",{className:"bg-yellow-50 text-yellow-600 px-2 py-0.5 rounded border border-yellow-100",children:["OD: ",s.od_students_json?.length]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:d=>{d.stopPropagation(),S("/mark",{state:{editMode:!0,logData:s,from:"/admin"}})},className:"bg-blue-50 text-blue-600 px-3 py-1.5 rounded-lg text-sm font-medium",children:"Edit"}),e.jsx("button",{onClick:d=>{d.stopPropagation(),Ae(s.id)},className:"bg-red-50 text-red-600 px-3 py-1.5 rounded-lg text-sm font-medium",children:"Delete"})]})]}),t&&e.jsxs("div",{className:"mt-4 pt-3 border-t text-sm animate-fade-in",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"font-bold text-red-600 block text-xs uppercase tracking-wider mb-1",children:"Absentees"}),r.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:r.map(d=>e.jsx("span",{className:"bg-red-50 text-red-700 px-2 py-1 rounded-lg text-xs border border-red-100 font-medium",children:d},d))}):e.jsx("span",{className:"text-gray-400 italic text-xs",children:"None"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-yellow-600 block text-xs uppercase tracking-wider mb-1",children:"On Duty"}),c.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(d=>e.jsx("span",{className:"bg-yellow-50 text-yellow-700 px-2 py-1 rounded-lg text-xs border border-yellow-100 font-medium",children:d},d))}):e.jsx("span",{className:"text-gray-400 italic text-xs",children:"None"})]})]})]},s.id)})]})]}),o==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 mb-4",children:"Academic Settings"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Academic Start Date"}),e.jsx("p",{className:"text-xs text-gray-400 mb-3 leading-relaxed",children:"Attendance percentage starts calculating from this date."}),e.jsx("input",{type:"date",className:"border p-4 rounded-xl w-full bg-gray-50 focus:ring-2 focus:ring-blue-100 outline-none transition-all",value:I,onChange:s=>ee(s.target.value)}),e.jsx("button",{onClick:Se,className:"w-full mt-4 bg-blue-600 text-white py-3 rounded-xl font-bold shadow-lg shadow-blue-200 active:scale-95 transition-transform",children:"Save Start Date"})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 mb-4",children:"Holidays"}),e.jsxs("div",{className:"flex flex-col gap-3 mb-6",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",className:"border p-3 rounded-xl bg-gray-50 w-40",value:f.date,onChange:s=>F({...f,date:s.target.value})}),e.jsx("input",{className:"border p-3 rounded-xl bg-gray-50 flex-1",placeholder:"Holiday Description (e.g. Diwali)",value:f.description,onChange:s=>F({...f,description:s.target.value})})]}),e.jsx("button",{onClick:ke,className:"bg-green-600 text-white py-3 rounded-xl font-bold shadow-md active:scale-95 transition-transform",children:"Add Holiday"})]}),e.jsxs("div",{className:"space-y-2",children:[ae.length===0&&e.jsx("p",{className:"text-center text-gray-400 text-sm",children:"No holidays added."}),ae.map(s=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-xl border border-gray-100",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-gray-800 block",children:s.description}),e.jsx("span",{className:"text-xs text-gray-500",children:s.date})]}),e.jsx("button",{onClick:()=>Ce(s.id),className:"bg-red-50 text-red-600 p-2 rounded-lg hover:bg-red-100 transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},s.id))]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 mb-4",children:"Special Schedules (Day Order Change)"}),e.jsx("p",{className:"text-xs text-gray-400 mb-4",children:"Make a specific date follow a different day's timetable (e.g. Saturday following Monday order)."}),e.jsxs("div",{className:"flex flex-col gap-3 mb-6",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",className:"border p-3 rounded-xl bg-gray-50 flex-1",value:m.date,onChange:s=>H({...m,date:s.target.value})}),e.jsx("select",{className:"border p-3 rounded-xl bg-gray-50 flex-1",value:m.day_order,onChange:s=>H({...m,day_order:s.target.value}),children:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"].map(s=>e.jsx("option",{children:s},s))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"border p-3 rounded-xl bg-gray-50 flex-1",placeholder:"Description (Optional)",value:m.description,onChange:s=>H({...m,description:s.target.value})}),e.jsx("button",{onClick:_e,className:"bg-purple-600 text-white px-6 rounded-xl font-bold shadow-md active:scale-95 transition-transform",children:"Set Override"})]})]}),e.jsxs("div",{className:"space-y-2",children:[re.length===0&&e.jsx("p",{className:"text-center text-gray-400 text-sm",children:"No active overrides."}),re.map(s=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-purple-50 rounded-xl border border-purple-100",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-bold text-purple-900 block",children:[s.date," ",e.jsx("span",{className:"text-gray-400",children:"→"})," ",s.day_order," Order"]}),s.description&&e.jsx("span",{className:"text-xs text-gray-500",children:s.description})]}),e.jsx("button",{onClick:()=>Le(s.id),className:"bg-white text-red-600 p-2 rounded-lg border border-purple-100 shadow-sm hover:bg-red-50 transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},s.id))]})]})]})]})]}):e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[50vh] p-4 bg-gray-50 h-screen",children:e.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-xl w-full max-w-sm text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-gray-800",children:"Admin Login"}),e.jsx("input",{type:"password",placeholder:"Enter Password",className:"border p-3 rounded-xl mb-4 w-full bg-gray-50 focus:ring-2 focus:ring-blue-100 outline-none",value:J||"",onChange:s=>ce(s.target.value)}),e.jsx("button",{onClick:Ne,className:"bg-blue-600 text-white px-6 py-3 rounded-xl font-bold w-full shadow-lg shadow-blue-200",children:"Login"})]})})};function Ke(){const S="/Attendence/".endsWith("/")?"/Attendence/admin":"/Attendence//admin";return e.jsx(Ve,{basename:S,children:e.jsx("div",{className:"fixed inset-0 w-full h-full bg-gray-100 font-sans text-gray-900 flex flex-col overflow-hidden",children:e.jsx("div",{className:"h-full w-full sm:max-w-2xl sm:mx-auto bg-white shadow-xl relative overflow-hidden",children:e.jsxs(Fe,{children:[e.jsx(oe,{path:"/",element:e.jsx(Je,{})}),e.jsx(oe,{path:"/mark",element:e.jsx(Xe,{})})]})})})})}Ge.createRoot(document.getElementById("root")).render(e.jsx(l.StrictMode,{children:e.jsx(Ke,{})}));
